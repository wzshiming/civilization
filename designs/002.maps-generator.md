# Maps Generator

See [000.definition.md](000.definition.md) for base type definitions and [001.maps.md](001.maps.md) for map structure.

## Overview

This document defines the map generator system responsible for creating game worlds with irregular plot shapes, dynamic attributes, and configurable terrain generation. The generator transforms configuration parameters into fully initialized maps with interconnected plots, terrain, and resources.

## Design Goals

1. **Irregular Plot Shapes**: Generate non-uniform, natural-looking plots using Voronoi tessellation
2. **Neighbor Relationships**: Maintain explicit adjacency information between plots
3. **Flexible Projections**: Support flat, cylindrical, and spherical projections with edge wrapping
4. **Configurable Terrain**: Allow control over ocean percentage, continent distribution, and climate zones
5. **Extensible Attributes**: Support dynamic addition of plot attributes (temperature, altitude, humidity, resources, etc.)
6. **Deterministic Generation**: Use seed-based random generation for reproducibility

## Generator Architecture

```
MapGenerator {
    config: MapConfig
    
    Generate() -> Map
}
```

## Generation Pipeline

The map generation follows a multi-phase pipeline:

1. **Plot Generation**: Create irregular plot shapes using Voronoi tessellation with Lloyd's relaxation for even distribution
2. **Neighbor Calculation**: Identify adjacent plots by analyzing shared edges, accounting for projection wrapping
3. **Terrain Generation**: Assign terrain types (ocean, land varieties) using elevation maps and ocean percentage configuration
4. **Resource Generation**: Distribute resources based on terrain suitability and configured density
5. **Building Generation**: Initialize available building types for the map
6. **Skill Generation**: Define skill types that populations can develop
7. **Religion Generation**: Create initial religions with their relationships
8. **Culture Generation**: Establish cultures with their affinities
9. **Population Generation**: Place initial populations in suitable plots

## Projection Types

### Flat Projection
```
ProjectionConfig {
    wrapHorizontal: false
    wrapVertical: false
    poleScaling: 1.0
}
```
- No edge wrapping
- Uniform plot sizes
- Suitable for regional maps

### Cylindrical Projection
```
ProjectionConfig {
    wrapHorizontal: true
    wrapVertical: false
    poleScaling: 1.0
}
```
- Left-right edges connect
- Top and bottom are boundaries
- Suitable for world maps without poles

### Spherical Projection
```
ProjectionConfig {
    wrapHorizontal: true
    wrapVertical: true
    poleScaling: 1.5  // Larger polar plots
}
```
- All edges wrap around
- Polar regions have larger plots (due to projection distortion)
- Best representation of planetary surface

**Optimization Strategies**:
- Use spatial indexing (quadtree/grid) for neighbor searches
- Cache expensive calculations (ocean distance, climate zones)
- Generate attributes lazily when first accessed
- Support streaming generation for very large maps

## Example Configuration

```json
{
  "plotCount": 2000,
  "dimensions": {
    "width": 1000.0,
    "height": 600.0
  },
  "projection": {
    "wrapHorizontal": true,
    "wrapVertical": true,
    "poleScaling": 1.5
  },
  "terrain": {
    "oceanPercentage": 0.65,
    "continentCount": 4,
    "islandFrequency": 0.15,
    "coastalRoughness": 0.3
  },
  "resourceDensity": 0.08,
  "climateVariance": 0.2,
  "randomSeed": 42,
  "relaxationSteps": 3
}
```
