# Maps Generator

See [000.definition.md](000.definition.md) for base type definitions and [001.maps.md](001.maps.md) for map structure.

## Overview

This document defines the map generator system responsible for creating game worlds with irregular plot shapes, dynamic attributes, and configurable terrain generation. The generator transforms configuration parameters into fully initialized maps with interconnected plots, terrain, and resources.

## Design Goals

1. **Irregular Plot Shapes**: Generate non-uniform, natural-looking plots using Voronoi tessellation
2. **Neighbor Relationships**: Maintain explicit adjacency information between plots
3. **Flexible Projections**: Support flat, cylindrical, and spherical projections with edge wrapping
4. **Configurable Terrain**: Allow control over ocean percentage, continent distribution, and climate zones
5. **Extensible Attributes**: Support dynamic addition of plot attributes (temperature, altitude, humidity, resources, etc.)
6. **Deterministic Generation**: Use seed-based random generation for reproducibility

## Generator Architecture

```
MapGenerator {
    config: MapConfig
    
    Generate() -> Map
}
```

## Projection Types

### Flat Projection
```
ProjectionConfig {
    wrapHorizontal: false
    wrapVertical: false
    poleScaling: 1.0
}
```
- No edge wrapping
- Uniform plot sizes
- Suitable for regional maps

### Cylindrical Projection
```
ProjectionConfig {
    wrapHorizontal: true
    wrapVertical: false
    poleScaling: 1.0
}
```
- Left-right edges connect
- Top and bottom are boundaries
- Suitable for world maps without poles

### Spherical Projection
```
ProjectionConfig {
    wrapHorizontal: true
    wrapVertical: true
    poleScaling: 1.5  // Larger polar plots
}
```
- All edges wrap around
- Polar regions have larger plots (due to projection distortion)
- Best representation of planetary surface

**Optimization Strategies**:
- Use spatial indexing (quadtree/grid) for neighbor searches
- Cache expensive calculations (ocean distance, climate zones)
- Generate attributes lazily when first accessed
- Support streaming generation for very large maps

## Unit Generation

The map generator creates units on appropriate terrain during map generation. Units are categorized into building units (stationary) and movable units.

### Building Units

Building units are stationary structures placed on plots based on terrain compatibility and resource availability.

```
BuildingUnitConfig {
    unitTypeID: UnitTypeID
    terrainCompatibility: []TerrainTypeID
    spawnProbability: float       // 0.0 to 1.0
    minDistanceFromSimilar: int   // Minimum plots between same type
    requiredResources: []ResourceTypeID?
}
```

**Default Building Unit Types:**
- **Cave**: Natural shelter, spawns in mountain and hill terrain
- **Bonfire**: Basic gathering point, spawns in forest and grassland terrain
- **Farm ground**: Agricultural area, spawns in grassland and plains terrain
- **Ranch ground**: Animal husbandry area, spawns in grassland and savanna terrain
- **Fishing ground**: Fishing area, spawns in coastal and river terrain
- **Picking ground**: Foraging area, spawns in forest and jungle terrain

### Movable Units

Movable units are mobile groups that can traverse the map. They are placed on suitable starting locations during generation.

```
MovableUnitConfig {
    unitTypeID: UnitTypeID
    terrainCompatibility: []TerrainTypeID
    spawnProbability: float       // 0.0 to 1.0
    initialSize: int
    requiredClusterType: ClusterTypeID?
}
```

**Default Movable Unit Types:**
- **Hunting team**: Resource gathering unit, spawns near forests and animal clusters
- **Trade team**: Commerce unit, spawns near settlements and trade routes
- **Warriors team**: Combat unit, spawns near settlements for defense

## Cluster Generation

The map generator creates clusters representing groups of entities. Clusters are categorized into enlightened (sentient beings) and animal clusters.

### Enlightened Clusters

Enlightened clusters represent sentient species capable of civilization building.

```
EnlightenedClusterConfig {
    clusterTypeID: ClusterTypeID
    terrainPreference: []TerrainTypeID
    spawnProbability: float       // 0.0 to 1.0
    initialSize: int
    skillAffinity: []SkillTypeID?
}
```

**Default Enlightened Cluster Types:**
- **Human**: Versatile species, prefers grassland and temperate terrain
- **Elf**: Nature-aligned species, prefers forest and woodland terrain
- **Orc**: Hardy species, prefers mountain and harsh terrain

### Animal Clusters

Animal clusters represent groups of animals that can be domesticated or hunted.

```
AnimalClusterConfig {
    clusterTypeID: ClusterTypeID
    terrainCompatibility: []TerrainTypeID
    spawnProbability: float       // 0.0 to 1.0
    herdSize: int
    domesticable: bool
}
```

**Default Animal Cluster Types:**
- **Horse**: Fast mount, spawns in grassland and plains
- **Cattle**: Livestock for food and labor, spawns in grassland
- **Chicken**: Poultry for food, spawns near settlements
- **Goat**: Hardy livestock, spawns in mountain and hill terrain
- **Sheep**: Wool and food source, spawns in grassland and meadow terrain

## Example Configuration

```json
{
  "plotCount": 2000,
  "dimensions": {
    "width": 1000.0,
    "height": 600.0
  },
  "projection": {
    "wrapHorizontal": true,
    "wrapVertical": true,
    "poleScaling": 1.5
  },
  "terrain": {
    "oceanPercentage": 0.65,
    "continentCount": 4,
    "islandFrequency": 0.15,
    "coastalRoughness": 0.3
  },
  "resourceDensity": 0.08,
  "climateVariance": 0.2,
  "randomSeed": 42,
  "relaxationSteps": 3,
  "units": {
    "buildingUnits": [
      { "type": "cave", "spawnProbability": 0.05 },
      { "type": "bonfire", "spawnProbability": 0.03 },
      { "type": "farmGround", "spawnProbability": 0.04 },
      { "type": "ranchGround", "spawnProbability": 0.03 },
      { "type": "fishingGround", "spawnProbability": 0.06 },
      { "type": "pickingGround", "spawnProbability": 0.05 }
    ],
    "movableUnits": [
      { "type": "huntingTeam", "spawnProbability": 0.02 },
      { "type": "tradeTeam", "spawnProbability": 0.01 },
      { "type": "warriorsTeam", "spawnProbability": 0.02 }
    ]
  },
  "clusters": {
    "enlightened": [
      { "type": "human", "spawnProbability": 0.03, "initialSize": 10 },
      { "type": "elf", "spawnProbability": 0.02, "initialSize": 8 },
      { "type": "orc", "spawnProbability": 0.02, "initialSize": 12 }
    ],
    "animals": [
      { "type": "horse", "spawnProbability": 0.04, "herdSize": 5 },
      { "type": "cattle", "spawnProbability": 0.05, "herdSize": 8 },
      { "type": "chicken", "spawnProbability": 0.06, "herdSize": 12 },
      { "type": "goat", "spawnProbability": 0.04, "herdSize": 6 },
      { "type": "sheep", "spawnProbability": 0.05, "herdSize": 10 }
    ]
  }
}
```
